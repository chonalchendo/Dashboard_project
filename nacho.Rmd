---
title: "R Notebook"
output: html_notebook
---
These are persons non only numbers the only knowledge is to know  which areas need better response


Temporal: How has this issue changed over time? (Is it getting better or worse?)

Geographic: How does this issue differ between areas in Scotland? (Where should efforts be focussed?)

Demographic: Who is most affected by this issue? (Who should be targeted with efforts?) . have Age/ gender
Nop but we have Paediatrics (medical & surgical) and Gynaecology  = Ethical problems?to obtain age and sex
How  to make a map if you dont hace the coordinates?


```{r}
library(tidyverse)
library(janitor)
library(lubridate)



admin_hb_speciality <- read_csv("raw_data/hospital_admissions_hb_specialty_20221102.csv")

```

```{r}
#start cleaning. Dates from 20200105 to 20221023

admin_hb_speciality <- admin_hb_speciality %>% clean_names()

```

```{r}
# Delete columns : HBFQ - NA/ d , admission_type_qf : NA, specialty_qf : NA

admin_hb_speciality <- admin_hb_speciality %>% 
  select(-c(3,5,7))

```

```{r}
#Change column  'hb' to 'healthboard'
admin_hb_speciality <- admin_hb_speciality %>% 
  rename(healthboard = hb) %>%
  mutate(healthboard = recode(healthboard,
                     "S08000015" = "NHS Ayrshire and Arran",
                     "S08000016" = "NHS Borders",
                     "S08000017" = "NHS Dumfries and Galloway",
                     "S08000019" = "NHS Forth Valley",
                     "S08000020" = "NHS Grampian",
                     "S08000022" = "NHS Highland",
                     "S08000024" = "NHS Lothian",
                     "S08000025" = "NHS Orkney",
                     "S08000026" = "NHS Shetland",
                     "S08000028" = "NHS Western Isles",
                     "S08000029" = "NHS Fife",
                     "S08000030" = "NHS Tayside",
                     "S08000031" = "NHS Greater Glasgow and Clyde",
                     "S08000032" = "NHS Lanarkshire",
                     "S92000003" = "Scotland",
                     "SB0801"    = "The Golden Jubille National",
                     "S08000018" = "NHS Fife",
"S08000021" = "NHS Greater Glasgow and Clyde",
"S08000023" = "NHS Lanarkshire",
"S08000027" = "NHS Tayside"))
  
view(admin_hb_speciality)
```

```{r}
# modify date
admin_hb_speciality <-  admin_hb_speciality %>% 
  mutate(week_ending = ymd(week_ending),
         month_enter = month(week_ending, label = TRUE, abbr = FALSE),
         year_enter = year(week_ending),
         day_enter = day(week_ending))

view(admin_hb_speciality)
```

WHATS HAPPENED JUST BEFORE LOCKDOWN/PANDEMIC THE LOCKDOWN WAS IN  march 25 WAS ALBA'S BIRTHDAY(march 26) TILL END YEAR 21
WE HAVE ASK ADMISSION BETWEEN 20 -21 BY  SPECIALITY, HEALTHBOARD


```{r}
# number admission per year, month, specialty in all Scotland
admin_hb_speciality %>% 
  select(year_enter, quarters, number_admissions,specialty, healthboard) %>% 
  group_by(healthboard, quarters) %>% 
  filter(specialty == 'All') %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))

```
```{r}
 # number admission per year, month, specialty in all Scotland. More specific, no medical() NO RESULT EXPECTED
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty) %>% 
  filter(specialty != c('All','Medical(incl. Cardiology & Cancer','Medical(excl.Cardiology & Cancer')) %>% 
  arrange(desc(number_admissions))
```


```{r}
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty) %>% 
  filter(specialty == 'All') %>% 
  arrange(desc(number_admissions))
```



Admission January-February-March 20-21-22 ALL SPECIALTY
```{r}
#Admission pre-lockdown
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2020') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('January', 'February','March')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

```{r}
#admission in Lockdown 2021
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2021') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('January', 'February','March')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```
```{r}
#admissionslockdown 2022
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2022') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('January', 'February','March')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```
Admissions June-July-August. 2020-2021-2022
```{r}
# 2020

admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2020') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('June', 'July','August')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```
```{r}
#2021
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2021') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('June', 'July','August')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))

```


```{r}
#2022
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2022') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('June', 'July','August')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

Admissions October-November-December 2020-2021-2022


```{r}
#2020
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2020') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('October', 'November','December')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

```{r}
#2021
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2021') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('October', 'November','December')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

```{r}
#2022
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2022') %>% 
  filter(specialty == 'All') %>% 
  filter(month_enter == c('October', 'November','December')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```
we dont have in the dataset sex or age but we have Paediatrics (medical & surgical)/Paediatrics (medical) for Kids and Gynaecology for Female but is it ethical if there is not a specific column for that??

Admissions Paediatric January-Ferbruary-March years 20-21-22

```{r}
#2020
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2020') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('January', 'February','March')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```


```{r}
#2021
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2021') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('January', 'February','March')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```


```{r}
#2022
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2022') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('January', 'February','March')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

Admissions Paediatric June-july-August years 20-21-22

```{r}
#2020
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2020') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('June', 'July','August')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

```{r}
#2021
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2021') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('June', 'July','August')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

```{r}
#2022
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2022') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('June', 'July','August')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

Admissions Paediatric October-November-December years 20-21-22

```{r}
#2020
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2020') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('October', 'November','December')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```

```{r}
#2021
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2020') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('October', 'November','December')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```


```{r}
#2022
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  filter(year_enter == '2022') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('October', 'November','December')) %>% 
  filter(healthboard != 'Scotland') %>% 
  arrange(desc(number_admissions))
```



ANSWER. COVID CRISSIS : INCREASE DURING WINTER NUMBER ADMISSIONS AFTER THE FIRST YEAR LOCKDOWN.



which questions to resolve




```{r}
admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  group_by(healthboard) %>% 
  filter(year_enter == '2022') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('October', 'November','December')) %>% 
  filter(healthboard != 'Scotland') %>%
  summarise(mean_kids = mean(number_admissions)) %>% 
  arrange(desc(mean_kids))
  
  
  

```

Number total admissions by year/nhs

```{r}
admin_hb_speciality %>% 
  select(year_enter, number_admissions,specialty) %>% 
  group_by(specialty) %>% 
  filter(specialty != 'All') %>% 
  arrange(desc(number_admissions))
```



```{r}
#Ok this is the total number of mentions in each speciality . Total?
admin_hb_speciality %>% 
  select(year_enter, number_admissions,specialty, healthboard) %>% 
  group_by(specialty) %>% 
  filter(specialty != 'All') %>% 
  count()
```


```{r}
##Ok this is the total number of mentions in each speciality. Year 2020
admin_hb_speciality %>% 
  select(year_enter, number_admissions,specialty) %>% 
  group_by(specialty) %>% 
  filter(year_enter == '2020') %>% 
  filter(specialty != 'All') %>% 
  count()
```

```{r}
#Ok this is the total number of mentions in each speciality. Year 2021
admin_hb_speciality %>% 
  select(year_enter, number_admissions,specialty, healthboard) %>% 
  group_by(specialty) %>% 
   filter(year_enter == '2021') %>% 
  filter(specialty != 'All') %>% 
  count()
```


```{r}
#Ok this is the total number of mentions in each speciality. Year 2022

admin_hb_speciality %>% 
  select(year_enter, number_admissions,specialty, healthboard) %>% 
  group_by(specialty) %>% 
   filter(year_enter == '2022') %>% 
  filter(specialty != 'All') %>% 
  count()

```

```{r}
#number admissions

admin_hb_speciality %>% 
  select(year_enter, number_admissions,specialty, healthboard) %>% 
  group_by(healthboard) %>% 
   filter(year_enter == '2022') %>% 
  filter(specialty == 'All') %>% 
  count(number_admissions)
```


```{r}
admin_hb_speciality %>% 
  select(year_enter, number_admissions,specialty, healthboard) %>% 
  group_by(year_enter) %>% 
  filter(year_enter =='2020') %>% 
  filter(healthboard != 'Scotland') %>% 
  filter(specialty == 'All') %>% 
  arrange(desc(number_admissions))
```

```{r}
admin_hb_speciality %>% 
  select(year_enter,month_enter, number_admissions,specialty, healthboard) %>% 
  group_by(year_enter, month_enter, healthboard) %>% 
  filter(specialty == 'All') %>% 
  mutate( total_admissions = sum(number_admissions)) %>% 
  mutate(total_month = sum(month_enter))
#%>% 
  #filter(month_enter == 'January') %>% 
  filter(healthboard == 'Scotland') %>% 
  filter(specialty == 'All') %>% 
  arrange(desc(number_admissions))
```





```{r}
#TRY


mean_kids_2022_october_december <- admin_hb_speciality %>% 
  select(year_enter, month_enter,day_enter, number_admissions,specialty,healthboard) %>% 
  group_by(healthboard) %>% 
  filter(year_enter == '2022') %>% 
  filter(specialty %in% c('Paediatrics (medical & surgical)','Paediatrics (medical)')) %>% 
  filter(month_enter == c('October', 'November','December')) %>% 
  filter(healthboard != 'Scotland') %>%
  summarise(mean_kids = mean(number_admissions)) %>% 
  arrange(desc(mean_kids))
  


mean_kids_2022_october_december
```



```{r}
mean_kids_2022_october_december %>% 
ggplot(aes(x= mean_kids, y = healthboard ))+
  geom_point()
```







